{% extends "base.html" %}

{% load static %}

{% block content %}
<!-- Filter Tours Section -->
<section class="container d-flex justify-content-end pt-3 pb-3">
    <div class="row">
        <div class="col">
            <!-- Filter Tours Menu -->
            <div class="btn-group">
                <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown"
                    aria-expanded="false">
                    Filter Tours
                </button>
                <ul class="dropdown-menu">
                    <a href="" class="dropdown-item">By Price</a>
                    <a href="" class="dropdown-item ">By Rating</a>
                    <a href="" class="dropdown-item ">By Category</a>
                    <a href="" class="dropdown-item">Most Recent</a>
                    <a href="{% url 'tours-list' %}" class="dropdown-item">All Tours</a>
                </ul>
            </div>
        </div>
        <div class="col">
            <!-- Special Offers Filter Menu -->
            <div class="btn-group">
                <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown"
                    aria-expanded="false">
                    Special Offers
                </button>
                <ul class="dropdown-menu">
                    <a href="" class="dropdown-item">Group Discounts</a>
                    <a href="" class="dropdown-item ">Last Minute Deals</a>
                </ul>
            </div>
        </div>
    </div>
</section>


<!-- Empty div to land the link from the pagination page to the tours list section 
                so not blocked by fixed header -->
<div id="tours-list"></div>


<!-- List of Tours -->
<section class="container d-flex justify-content-center">
    <div>
        {%  for tour in tours  %}
        <div class=" card mb-3 shadow p-2 mb-3 bg-body rounded" style="max-width: 900px;">
            <div class="row g-0">
                <div class="col-md-5">
                    {%  if tour.image_url  %}
                    <!-- Tour Image -->
                    <a href="{% url 'tour-detail' tour.id %}"><img
                            class="rounded-circle shadow mb-3 bg-body rounded mx-auto d-block mt-3"
                            src="{{tour.image_url }}" width="300" alt="Tour Image"></a>
                    {%  else  %}
                    <!-- Default Image -->
                    <a href="{% url 'tour-detail' tour.id %}"><img
                            class="rounded-circle shadow mb-3 bg-body rounded mx-auto d-block mt-3"
                            src="/media/temp-image.png" width="200" alt="Default Image"></a>
                    {%  endif  %}
                </div>
                <!-- Snippet Details of Each Tour-->
                <div class="col-md-7 text-md-start text-center">
                    <div class="card-body mb-3 mt-3">
                        <h4 class="card-title">
                            <a class="text-decoration-none"
                                href="{% url 'tour-detail' tour.id %}">{{  tour.tour_name  }}
                            </a>
                        </h4>
                        {% if product.rating %}
                        <p class="card-text list-inline-item p-2"><small class="text-muted"><strong><i
                                        class="fa-regular fa-star"></i>
                                    Rating: </strong>
                                <i>{{ tour.rating }}</i>
                            </small></p>
                        {% else %}
                        <p class="card-text list-inline-item p-2"><small class="text-muted"><strong><i
                                        class="fa-regular fa-star"></i>
                                    Not Rated Yet</strong>
                            </small></p>
                        {% endif %}
                        <p class="card-text list-inline-item p-2"><small class="text-muted"><strong><i
                                        class="fa-regular fa-comment"></i>
                                    Review{{ tour.reviews.count|pluralize }}: </strong>
                                <i>{{ tour.reviews.count }}</i>
                            </small></p>
                        <p class="card-text list-inline-item p-2"><small class="text-muted"><strong><i
                                        class="fa-solid fa-euro-sign"></i>
                                    <i>{{ tour.price }}</i> per person
                                </strong></small></p>
                        <p class="card-text text-start p-2">
                            {{  tour.description | striptags | slice:100 | safe  }}.......
                        </p>
                    </div>
                </div>
            </div>
        </div>
        {%  endfor  %}
    </div>
</section>

<!-- Tours List Pagination -->
<section class="paginate d-flex justify-content-center mb-4 mt-3">
    {%  if is_paginated  %}

    {%  if page_obj.has_previous  %}
    <a class="btn btn-outline-secondary btn-sm mb4 me-1" href="?page=1#tours-list">First</a>
    <a class="btn btn-outline-secondary btn-sm mb4 me-1"
        href="?page={{  page_obj.previous_page_number  }}#tours-list">Previous</a>
    {%  endif  %}

    {%  for num in page_obj.paginator.page_range  %}
    {%  if page_obj.number == num  %}
    <a class="btn btn-secondary btn-sm mb4 me-1" href="?page={{  num  }}#tours-list">{{  num  }}</a>
    {%  elif num > page_obj.number|add:"-3" and num < page_obj.number|add:"3"  %}
    <a class="btn btn-outline-secondary btn-sm mb4 me-1" href="?page={{  num  }}#tours-list">{{  num  }}</a>
    {%  endif  %}
    {%  endfor  %}

    {%  if page_obj.has_next  %}
    <a class="btn btn-outline-secondary btn-sm mb4 me-1"
        href="?page={{  page_obj.next_page_number  }}#tours-list">Next</a>
    <a class="btn btn-outline-secondary btn-sm mb4 me-1"
        href="?page={{  page_obj.paginator.num_pages  }}#tours-list">Last</a>
    {%  endif  %}

    {%  endif  %}
</section>


{% endblock %}