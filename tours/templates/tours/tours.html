{% extends "base.html" %}

{% load static %}

{% block content %}

<!-- Tours List Page Title -->
<div class="row g-0 mt-4">
    <div class="col-md-8 offset-md-1 text-center text-md-start">
        <h1>TimeTravelling Tours</h1>
        <h2>Search a Moment in Time</h2>
    </div>

    <div class="filter-menu pt-5 pb-3 col-md-7 offset-md-2 text-center text-md-start">
        <!-- Filter Tours Menu -->
        <div class="btn-group">
            <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown"
                aria-expanded="false">
                Filter Tours
            </button>
            <ul class="dropdown-menu">
                <a href="" class="dropdown-item" aria-label="#">By Price</a>
                <a href="" class="dropdown-item" aria-label="#">By Rating</a>
                <a href="" class="dropdown-item" aria-label="#">By Category</a>
                <a href="" class="dropdown-item" aria-label="#">Most Recent</a>
                <a href="{% url 'tours-list' %}" aria-label="Go to Tours List" class="dropdown-item">All Tours</a>
            </ul>
        </div>

        <!-- Special Offers Filter Menu -->
        <div class="btn-group">
            <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown"
                aria-expanded="false">
                Special Offers
            </button>
            <ul class="dropdown-menu">
                <a href="" class="dropdown-item" aria-label="#">Group Discounts</a>
                <a href="" class="dropdown-item" aria-label="#">Last Minute Deals</a>
            </ul>
        </div>
    </div>
</div>


<!-- Empty div to land the link from the pagination page to the tours list section 
                so not blocked by fixed header -->
<div id="tours-list"></div>


<!-- List of Tours -->

<section class="pt-3 pb-3 position-relative">
    <div class="container px-md-5">
        {%  for tour in tours  %}
        <div class="row">
            <div class="col-lg-4 col-sm-6 col-12 card mb-3 shadow p-2 mb-3 bg-body rounded">
                <div class="card-group">
                    <div class="card">

                        <!-- Tour Image -->
                        {%  if tour.image_url  %}
                        <a class="text-decoration-none" href="{% url 'tour-detail' tour.id %}"
                            aria-label="Go to Tour Detail"><img class="card-img-top rounded-circle"
                                src="{{tour.image_url }}" width="200px" alt="Tour Image"></a>
                        <div class="card-body">

                            {%  else  %}
                            <!-- Default Image -->
                            <a class="text-decoration-none" href="{% url 'tour-detail' tour.id %}"
                                aria-label="Go to Tour Detail"><img class="card-img-top rounded-circle"
                                    src="/media/time-travel-sample.jpeg" width="200px" alt="Tour Image"></a>
                            <div class="card-body">

                                {%  endif  %}

                                <!-- Tour Title-->
                                <h4 class="card-title"><a class="text-decoration-none"
                                        href="{% url 'tour-detail' tour.id %}"
                                        aria-label="Go to Tour Detail">{{  tour.tour_name  }}
                                    </a></h4>

                                <!-- Ratings-->
                                {% if product.rating %}
                                <p class="card-text list-inline-item p-2"><small class="text-muted"><strong><i
                                                class="fa-regular fa-star"></i>
                                            Rating: </strong>
                                        <i>{{ tour.rating }}</i>
                                    </small></p>
                                {% else %}
                                <p class="card-text list-inline-item p-2"><small class="text-muted"><strong><i
                                                class="fa-regular fa-star"></i>
                                            Not Rated Yet</strong>
                                    </small></p>
                                {% endif %}

                                <!-- Reviews-->
                                <p class="card-text list-inline-item p-2"><small class="text-muted"><strong><i
                                                class="fa-regular fa-comment"></i>
                                            Review{{ tour.reviews.count|pluralize }}: </strong>
                                        <i>{{ tour.reviews.count }}</i>
                                    </small>
                                </p>

                                <!-- Price-->
                                <p class="card-text list-inline-item p-2"><small class="text-muted"><strong><i
                                                class="fa-solid fa-euro-sign"></i>
                                            <i>{{ tour.price }}</i> per person
                                        </strong></small>
                                </p>

                                <!-- Tour Description Snippet-->
                                <p class="card-text">{{  tour.description | striptags | slice:100 | safe  }}.......</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {%  endfor  %}
    </div>
</section>


<!-- Tours List Pagination -->
<section class="paginate d-flex justify-content-center mb-4 mt-3">
    {%  if is_paginated  %}

    {%  if page_obj.has_previous  %}
    <a class="btn btn-outline-secondary btn-sm mb4 me-1" href="?page=1#tours-list">First</a>
    <a class="btn btn-outline-secondary btn-sm mb4 me-1"
        href="?page={{  page_obj.previous_page_number  }}#tours-list">Previous</a>
    {%  endif  %}

    {%  for num in page_obj.paginator.page_range  %}
    {%  if page_obj.number == num  %}
    <a class="btn btn-secondary btn-sm mb4 me-1" href="?page={{  num  }}#tours-list">{{  num  }}</a>
    {%  elif num > page_obj.number|add:"-3" and num < page_obj.number|add:"3"  %}
    <a class="btn btn-outline-secondary btn-sm mb4 me-1" href="?page={{  num  }}#tours-list">{{  num  }}</a>
    {%  endif  %}
    {%  endfor  %}

    {%  if page_obj.has_next  %}
    <a class="btn btn-outline-secondary btn-sm mb4 me-1"
        href="?page={{  page_obj.next_page_number  }}#tours-list">Next</a>
    <a class="btn btn-outline-secondary btn-sm mb4 me-1"
        href="?page={{  page_obj.paginator.num_pages  }}#tours-list">Last</a>
    {%  endif  %}

    {%  endif  %}
</section>


{% endblock %}